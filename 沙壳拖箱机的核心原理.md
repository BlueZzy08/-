## 从Dex的加载和编译流程出发

脱壳前会有 反调试 反虚拟机 环境监测。。。

- 反调试: 包括对gdb、ptrace的反调试，以及对JDWP的反调试。
- 模拟器/设备检测: 检测运行环境是否为模拟器或真实设备。
- Root检测: 检测设备是否已root。
- 混淆: 混淆不属于脱壳范畴，它是一个商检过程，信息在混淆过程中已损失。

## 脱壳的本质

安卓app脱壳的本质就是对内存中处于解密状态的dex的dump。首先要区分这里的脱壳和修复的区别。这里的脱壳指的是加固apk中保护的dex的整体dump，不挂失函数抽取、dex2c还是vmp壳，首先要做的就是对整体的dex的dump，然后再对脱壳下来的dex进行修复。要达到对apk的脱壳，最为关键的就是**准确定位内存中解密后的dex文件的起始地址和大小**。那么这里要达成对apk的成功脱壳，就有两个关键要素：

1、内存中dex的起始地址和大小

2、脱壳时机，只有正确的脱壳时机，才能dump下明文状态的dex。否则，时机不对，即使是正确的起始地址和大小，dump下来的也可能只是密文。InMemoryDexClassLoade代码分析
